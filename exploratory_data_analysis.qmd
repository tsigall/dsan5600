---
title: "Exploratory Data Analysis"
editor_options: 
  chunk_output_type: inline
toc: false
---

```{r setup, include = FALSE}
library(reticulate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(forecast)
library(TSstudio)
library(tseries)
library(gridExtra)
library(plotly)
```

```{r load_data, include = FALSE}
load("arrest_data.Rdata")
recidivism <- read.csv("recidivism.csv")
```

## By Crime

::: panel-tabset
### Total

```{r initial_viz, warning=FALSE, echo = FALSE}
plot_ly(data = arrests_by_date, 
        x = ~month, 
        y = ~total, 
        type = "scatter", 
        mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Arrests in New York City by Date",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

There appears to be some seasonality in the plot, as there are noticeable dips in arrest rate towards the end of each year. There was a slight upward trend towards the end of the 2000's but that changed dramatically during the 2010's into a clear downward trend. Since the start of the current decade the trend has reversed course, however. It is hard to tell if the time series is multiplicative or additive, as it seems to hold different characteristics at different points, though this possibly suggests a multiplicative time series. The change in trend could also be part of a longer cycle, though it is impossible to tell from this graph as it only goes back to 2006.

#### Lag Plots

```{r lag_plots, echo = FALSE}
arrests_ts <- ts(arrests_by_date$total, start = c(2006, 1), frequency = 12)

ts_lags(arrests_ts, lags = 1:12)
```

Looking at the lag plot up to a lag of 12 months, we can see that the data are clearly not random, as a linear shape exists in each lag that we observe here. Seasonality is harder to observe here, as each month does not appear to be clustered alongside other observations of the same month. This could be due to the large number of points, however.

```{r lag_48, echo = FALSE}

ts_lags(arrests_ts, lags = c(12, 24, 36, 48))
```

If we look up to a lag of 48 months, we can see that as the lag increases, the data get more random. The Lag 48 plot exhibiting less of a linear pattern than the lag 12 plot, which is fairly linear.

#### Decomposition

```{r decomposing, echo = FALSE}
plot(decompose(arrests_ts, "multiplicative"))

```

We can see the trend here that we were able to observe on the initial graph. There is horizontal movement during the first half of the observed period and then a clear downward trend until 2020. After that, it reverses and increases until the present day.

Removing the trend allows us to see some seasonality. Once the seasonality has been averaged out as it has been here, the clear dips in arrests towards the end of each year remain and there is a clear pattern between the large dips at the end of each month.

There seems to be more noise in the more recent data, which could be something interesting to look into.

#### ACF and PACF

```{r acf, echo = FALSE}
ggAcf(arrests_ts, 100) + ggtitle("ACF Plot for Annual New York City Arrests")
```

The ACF values are decaying towards zero as lag increases, which is evidence against seasonality.

```{r pacf, echo = FALSE}
ggPacf(arrests_ts, 100) + ggtitle("PACF Plot for Annual New York City Arrests")
```

Spikes can be seen at lags of 1, 2, 12, and 13.

#### Augmented Dickey-Fuller Test

```{r adf, echo = FALSE}
adf.test(arrests_ts)
```

The ADF tests returns a p-value of 0.26, meaning we do not have enough evidence to reject the null hypotheses. This series is not stationary.

#### Detrend and Difference

```{r detrend_and_difference}
detrend <- resid(lm(arrests_by_date$total ~ arrests_by_date$month, na.action = NULL))
difference <- diff(arrests_ts)

```

```{r multifigure_1}
grid.arrange(autoplot(arrests_ts),
             autoplot(as.ts(detrend)), 
             autoplot(difference), 
             ncol = 1)
```

The detrended series (the middle plot) does not seem to be vastly different from the original series. This could be evidence that there is not much of a trend in the data. The differenced series looks to be stationary, which suggests that there may be a trend.

```{r multifigure_2}
ggtsdisplay(difference)
```

This ACF has positive spikes at 12, 24, and 36, meaning once the trend is removed, the seasonality becomes evident. The ACF of the differenced time series provides strong evidence in support of seasonality.

### Assault

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
        x = ~month, 
        y = ~assault, 
        name = "Assault",
        type = "scatter", 
        mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Assault",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

insert text here

#### Lag Plots

```{r, echo = FALSE}
assault_ts <- ts(arrests_by_crime$assault, start = c(2006, 1), frequency = 12)

ts_lags(assault_ts, lags = 1:12)
```

insert text

```{r, echo = FALSE}

ts_lags(assault_ts, lags = c(12, 24, 36, 48))
```

insert text

#### Decomposition

```{r, echo = FALSE}
plot(decompose(assault_ts, "multiplicative"))

```

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Controlled Substance Possession

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month, 
            y = ~controlled_substance_possession, 
            name = "Controlled Substance Possession",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Controlled Substance Possession",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Controlled Substance Sale

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month, 
            y = ~controlled_substance_sale, 
            name = "Controlled Substance Sale",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Controlled Substance Sale",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Larceny

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month, 
            y = ~larceny, 
            name = "Larceny",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Larceny",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Marijuana Possession

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month, 
             y = ~marijuana_possession, 
            name = "Marijuana Possession",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Marijuana Possession",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Marijuana Sale

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month,  
            y = ~marijuana_sale, 
            name = "Marijuana Sale",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Marijuana Sale",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Motor Vehicle Theft

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month,  
            y = ~motor_vehicle_theft, 
            name = "Motor Vehicle Theft",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Motor Vehicle Theft",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Murder

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month,  
            y = ~murder, 
            name = "Murder",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Murderl",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference

### Robbery

```{r, echo = FALSE}
plot_ly(data = arrests_by_crime, 
            x = ~month,  
            y = ~robbery, 
            name = "Robbery",
            type = "scatter",
            mode = "lines",
        showlegend = TRUE) %>%
  layout(title = "Robbery",
         xaxis = list(title = ""),
         yaxis = list(title = "Arrests"))
```

#### Lag Plots

#### Decomposition

#### ACF and PACF

#### Augmented Dickey-Fuller Test

#### Detrend and Difference
:::

```{r, include = FALSE}
save(arrests_ts, file = "arrests_ts.Rdata")
```
