{"title":"Exploratory Data Analysis","markdown":{"yaml":{"title":"Exploratory Data Analysis","editor_options":{"chunk_output_type":"inline"},"toc":false},"headingText":"By Crime","containsRefs":false,"markdown":"\n\n```{r include = FALSE}\nknitr::opts_chunk$set(echo = FALSE)\n```\n\n```{r setup, include = FALSE}\nlibrary(reticulate)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(TSstudio)\nlibrary(tseries)\nlibrary(gridExtra)\nlibrary(plotly)\n```\n\n```{r load_data, include = FALSE}\nload(\"data/arrest_data.Rdata\")\nrecidivism <- read.csv(\"data/recidivism.csv\")\n```\n\n\n::: panel-tabset\n### Total\n\n```{r initial_viz, warning=FALSE, echo = FALSE}\nplot_ly(data = arrests_by_date, \n        x = ~month, \n        y = ~total, \n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Arrests in New York City by Date\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThere appears to be some seasonality in the plot, as there are noticeable dips in arrest rate towards the end of each year. There was a slight upward trend towards the end of the 2000's but that changed dramatically during the 2010's into a clear downward trend. Since the start of the current decade the trend has reversed course, however. It is hard to tell if the time series is multiplicative or additive, as it seems to hold different characteristics at different points, though this possibly suggests a multiplicative time series. The change in trend could also be part of a longer cycle, though it is impossible to tell from this graph as it only goes back to 2006.\n\n#### Lag Plots\n\n```{r lag_plots, echo = FALSE}\narrests_ts <- ts(scale(arrests_by_date$total), start = c(2006, 1), frequency = 12)\n\nts_lags(arrests_ts, lags = 1:12)\n```\n\nLooking at the lag plot up to a lag of 12 months, we can see that the data are clearly not random, as a linear shape exists in each lag that we observe here. Seasonality is harder to observe here, as each month does not appear to be clustered alongside other observations of the same month. This could be due to the large number of points, however.\n\n```{r lag_48, echo = FALSE}\nts_lags(arrests_ts, lags = c(12, 24, 36, 48))\n```\n\nIf we look up to a lag of 48 months, we can see that as the lag increases, the data get more random. The Lag 48 plot exhibiting less of a linear pattern than the lag 12 plot, which is fairly linear.\n\n#### Decomposition\n\n```{r decomposing, echo = FALSE}\nplot(decompose(arrests_ts, \"multiplicative\"))\n```\n\nWe can see the trend here that we were able to observe on the initial graph. There is horizontal movement during the first half of the observed period and then a clear downward trend until 2020. After that, it reverses and increases until the present day.\n\nRemoving the trend allows us to see some seasonality. Once the seasonality has been averaged out as it has been here, the clear dips in arrests towards the end of each year remain and there is a clear pattern between the large dips at the end of each year.\n\nThere seems to be more noise in the more recent data, which could be something interesting to look into.\n\n#### ACF and PACF\n\n```{r acf, echo = FALSE}\nggAcf(arrests_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Arrests\")\n```\n\nThe ACF values are decaying towards zero as lag increases, which is evidence that this series needs to be differenced.\n\n```{r pacf, echo = FALSE}\nggPacf(arrests_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Arrests\")\n```\n\nSpikes can be seen at lags of 1, 2, 12, and 13.\n\n#### Augmented Dickey-Fuller Test\n\n```{r adf, echo = FALSE}\nadf.test(arrests_ts)\n```\n\nThe ADF tests returns a p-value of 0.26, meaning we do not have enough evidence to reject the null hypotheses, the series is not stationary.\n\n#### Detrend and Difference\n\n```{r detrend_and_difference}\ndetrend <- resid(lm(arrests_by_date$total ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(arrests_ts)\n```\n\n```{r multifigure_1}\ngrid.arrange(autoplot(arrests_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nThe detrended series (the middle plot) does not seem to be vastly different from the original series. This could be evidence that there is not much of a trend in the data. The differenced series looks to be stationary, which suggests that there may be a trend.\n\n```{r multifigure_2}\nggtsdisplay(difference)\n```\n\nThis ACF has positive spikes at 12, 24, and 36, meaning once the trend is removed, the seasonality becomes evident. The ACF of the differenced time series provides strong evidence in support of seasonality. A SARIMA model would best suit this time series. \n\n### Assault\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n        x = ~month, \n        y = ~assault, \n        name = \"Assault\",\n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Assault\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis time series follows a very similar pattern to the overall arrests series. There is an upward trend until around 2013 then a downward trend to the minimum value in April 2020, then a sharp increase until today. The data are clearly seasonal as well, seeming to follow a yearly pattern with the yearly minimum happening each winter.\n\n#### Lag Plots\n\n```{r, echo = FALSE}\nassault_ts <- ts(scale(arrests_by_crime$assault), start = c(2006, 1), frequency = 12)\n\nts_lags(assault_ts, lags = 1:12)\n```\n\nThere is the most correlation between lags at a lag value of 12, further increasing evidence for the seasonality of this series. There appears to be less correlation here than in the total time series, though.\n\n```{r, echo = FALSE}\nts_lags(assault_ts, lags = c(12, 24, 36, 48))\n```\n\nThere is some correlation between yearly lags, meaning this may be a good candidate for seasonal differencing. This correlation appears to decrease as the lag increases.\n\n#### Decomposition\n\n```{r, echo = FALSE}\nplot(decompose(assault_ts, \"additive\"))\n```\n\nDecomposition reveals the trend we noticed in the overall plot, with the drop in 2020. The increase and decrease before that point, however, may be less than we initially thought.\n\n#### ACF and PACF\n\n```{r, echo = FALSE}\nggAcf(assault_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Assault Arrests\")\n```\n\nThe ACF Plot is decaying towards 0 though there is evidence of seasonality in the correlation between lags.\n\n```{r}\nggPacf(assault_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Assault Arrests\")\n\n```\n\nSpikes can be seen at lags 1, 2, 3, and 4.\n\n#### Augmented Dickey-Fuller Test\n\n```{r echo = FALSE}\nadf.test(assault_ts)\n```\n\nThe ADF tests returns a p-value of less than 0.01, meaning we do not have enough evidence to reject the null hypotheses, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$assault ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(assault_ts)\n\ngrid.arrange(autoplot(assault_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nDetrending does not change the time series much, suggesting the trend we saw earlier was not as significant as we thought. The time series was stationary before according to the ADF test, meaning differencing did not do much.\n\n```{r}\nggtsdisplay(difference)\n```\n\n\nThe evidence of seasonality throughout this process indicates a SARIMA model might be the best for this time series. \n\n### Controlled Substance Possession\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_possession, \n            name = \"Controlled Substance Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Controlled Substance Possession\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis looks different from the overall arrests time series. There is a clear negative linear trend in this series, though that trend hit its minimum in July 2020 and has generally been increasing since, though only slightly compared to the initial decrease.\n\n#### Lag Plots\n\n```{r}\ncontrolled_pos_ts <- ts(scale(arrests_by_crime$controlled_substance_possession), start = c(2006, 1), frequency = 12)\n\nts_lags(controlled_pos_ts, lags = 1:12)\n```\n\nThis series appears to be highly correlated as all of these lags show high levels of correlation.\n\n```{r}\nts_lags(controlled_pos_ts, lags = c(12, 24, 36, 48))\n```\n\nLike the other series, the correlation between lags gets less as the lag increases, though it is still fairly high.\n\n#### Decomposition\n\n```{r}\nplot(decompose(controlled_pos_ts, \"additive\"))\n```\n\nThe time series is clearly additive, and the negative trend becomes clear when decomposed. There does appear to be a seasonal component.\n\n#### ACF and PACF\n\n```{r}\nggAcf(controlled_pos_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Controled Substance Possession Arrests\")\n```\n\nThis is evidence against seasonality, and evidence that the series should be differenced.\n\n```{r}\nggPacf(controlled_pos_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Controled Substance Possession Arrests\")\n\n```\n\nSpikes are seen at 1, 2, 3, 8, and 12.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(controlled_pos_ts)\n```\n\nThe ADF test shows that this series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$controlled_substance_possession ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(controlled_pos_ts)\n\ngrid.arrange(autoplot(controlled_pos_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nDetrending clearly changes the time series to be more stationary, meaning there is a clear trend. Differencing also moves us closer to a stationary time series.\n\n```{r}\nggtsdisplay(difference)\n\n```\nThis series also seems to have a significant seasonal component, we will fit a SARIMA model. \n\n### Marijuana Possession\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_possession, \n            name = \"Marijuana Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Marijuana Possession\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis is an interesting one, as there is a clear positive trend at the start of the series which quickly reverses when policy changes were made as discussed before. The series eventually goes to zero as marijuana possession is now legal in New York City.\n\n#### Lag Plots\n\n```{r}\nmarijuana_pos_ts <- ts(scale(arrests_by_crime$marijuana_possession), start = c(2006, 1), frequency = 12)\n\nts_lags(marijuana_pos_ts, lags = 1:12)\n```\n\nThe lag plots look different from most others as there is less correlation in lag 12 than in lag 1, suggesting the data may not be seasonal.\n\n```{r}\nts_lags(marijuana_pos_ts, lags = c(12, 24, 36, 48))\n```\n\nThere is very little lag correlation over the 4 year period, even more evidence against seasonality.\n\n#### Decomposition\n\n```{r}\nplot(decompose(marijuana_pos_ts, \"additive\"))\n```\n\nWe can clearly see the trend observed in the initial plot here in the decomposition. If there were to be a seasonal component it looks to be yearly, but it is hard to tell.\n\n#### ACF and PACF\n\n```{r}\nggAcf(marijuana_pos_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Marijuana Possession Arrests\")\n```\n\nWe should difference this series, this ACF plot looks just like the others.\n\n```{r}\nggPacf(marijuana_pos_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Marijuana Possession Arrests\")\n\n```\n\nThere is a large spike at a lag of 1, then some smaller spikes at 2 and 5.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(marijuana_pos_ts)\n```\n\nWe do not have enough evidence to reject the null hypothesis, the series may not be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$marijuana_possession ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(marijuana_pos_ts)\n\ngrid.arrange(autoplot(marijuana_pos_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n\n```\n\nThe differenced plot looks more stationary, suggesting that differencing may be useful here. The strong seasonal component suggests a SARIMA model would be useful. \n\n### Motor Vehicle Theft\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~motor_vehicle_theft, \n            name = \"Motor Vehicle Theft\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Motor Vehicle Theft\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis series looks the most stationary out of any so far, there really does not seem to be any patterns to it.\n\n#### Lag Plots\n\n```{r}\nmotor_theft_ts <- ts(scale(arrests_by_crime$motor_vehicle_theft), start = c(2006, 1), frequency = 12)\n\nts_lags(motor_theft_ts, lags = 1:12)\n```\n\nThe lag plots support that conclusion, there seems to be little to no correlation between lags at any level.\n\n```{r}\nts_lags(motor_theft_ts, lags = c(12, 24, 36, 48))\n```\n\nThe absence of correlation continues up through high level of lag.\n\n#### Decomposition\n\n```{r}\nplot(decompose(motor_theft_ts, \"additive\"))\n```\n\nThe random component looks fairly similar to the observed series, which would make sense for a stationary series.\n\n#### ACF and PACF\n\n```{r}\nggAcf(motor_theft_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Motor Vehicle Theft Arrests\")\n```\n\nThere may be a slight seasonal component, but it is hard to tell.\n\n```{r}\nggPacf(motor_theft_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Motor Vehicle Theft Arrests\")\n\n```\n\nThere are spikes at 1, 2, 3, and 4, and there may be some seasonality.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(motor_theft_ts)\n```\n\nWe do not have enough evidence to reject the null hypothesis that the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$motor_vehicle_theft ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(motor_theft_ts)\n\ngrid.arrange(autoplot(motor_theft_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n\n```\n\nThe detrended plot looks very similar to the observed plot. There is no seasonal component here, an ARIMA model will work. \n\n### Murder\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~murder, \n            name = \"Murder\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Murder\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThe series here is mostly stationary until recently when the trend begins to increase. This is both interesting and concerning and should be looked into.\n\n#### Lag Plots\n\n```{r}\nmurder_ts <- ts(scale(arrests_by_crime$murder), start = c(2006, 1), frequency = 12)\n\nts_lags(murder_ts, lags = 1:12)\n```\n\nAs seen in the original graph, there is not much evidence for seasonality.\n\n```{r}\nts_lags(murder_ts, lags = c(12, 24, 36, 48))\n```\n\nEven when looking further out, there is not much evidence for seasonality.\n\n#### Decomposition\n\n```{r}\nplot(decompose(murder_ts, \"additive\"))\n```\n\nWe can see that same trend clearly here, there is an obvious increase in murder rate that started around 2020.\n\n#### ACF and PACF\n\n```{r}\nggAcf(murder_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Murder Arrests\")\n```\n\nThe ACF quickly decreases to 0, which means we may not need to difference it.\n\n```{r}\nggPacf(murder_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Murder Arrests\")\n\n```\n\nThe PACF plot looks good as well, there are only spikes at 1, 2, and 7.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(murder_ts)\n```\n\nThere is not enough evidence to reject the null hypothesis, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$murder ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(murder_ts)\n\ngrid.arrange(autoplot(murder_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n```\n\nThe differenced time series looks stationary, indicating that we may need to difference. There is little evidence for any seasonal components, an ARIMA model would be best. \n\n### Robbery\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~robbery, \n            name = \"Robbery\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Robbery\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThere is a clear negative trend throughout the series until 2020 when it changes significantly and becomes very positive.\n\n#### Lag Plots\n\n```{r}\nrobbery_ts <- ts(scale(arrests_by_crime$robbery), start = c(2006, 1), frequency = 12)\n\nts_lags(robbery_ts, lags = 1:12)\n```\n\nThere is some evidence for seasonality as there does appear to be some correlation between lagged values.\n\n```{r}\nts_lags(robbery_ts, lags = c(12, 24, 36, 48))\n```\n\nSome correlation remains even at larger lag values.\n\n#### Decomposition\n\n```{r}\nplot(decompose(robbery_ts, \"additive\"))\n```\n\nWe can see that the trend does not seem to be as negative as we previously thought, and the dip in 2020 may just be a dip as levels have gone back to post-pandemic values.\n\n#### ACF and PACF\n\n```{r}\nggAcf(robbery_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Robbery Arrests\")\n```\n\nThis series looks like it needs to be differenced as there are many significant ACF values.\n\n```{r}\nggPacf(robbery_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Robbery Arrests\")\n\n```\n\nThere are spikes at 1, 2, and 3.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(robbery_ts)\n```\n\nWe have enough evidence to reject the null hypothesis, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$robbery ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(robbery_ts)\n\ngrid.arrange(autoplot(robbery_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n```\n\nThe differenced time series looks to be stationary meaning differencing may be useful. The existence of a clear seasonal component means we should fit a SARIMA model. \n:::\n\n```{r, include = FALSE}\nsave(arrests_ts, \n       assault_ts, \n       controlled_pos_ts, \n       marijuana_pos_ts, \n       motor_theft_ts,\n       murder_ts,\n       robbery_ts, file = \"data/arrests_ts.Rdata\")\n\nwrite.csv(arrests_ts, \"data/arrests_ts.csv\")\n```\n","srcMarkdownNoYaml":"\n\n```{r include = FALSE}\nknitr::opts_chunk$set(echo = FALSE)\n```\n\n```{r setup, include = FALSE}\nlibrary(reticulate)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(forecast)\nlibrary(TSstudio)\nlibrary(tseries)\nlibrary(gridExtra)\nlibrary(plotly)\n```\n\n```{r load_data, include = FALSE}\nload(\"data/arrest_data.Rdata\")\nrecidivism <- read.csv(\"data/recidivism.csv\")\n```\n\n## By Crime\n\n::: panel-tabset\n### Total\n\n```{r initial_viz, warning=FALSE, echo = FALSE}\nplot_ly(data = arrests_by_date, \n        x = ~month, \n        y = ~total, \n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Arrests in New York City by Date\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThere appears to be some seasonality in the plot, as there are noticeable dips in arrest rate towards the end of each year. There was a slight upward trend towards the end of the 2000's but that changed dramatically during the 2010's into a clear downward trend. Since the start of the current decade the trend has reversed course, however. It is hard to tell if the time series is multiplicative or additive, as it seems to hold different characteristics at different points, though this possibly suggests a multiplicative time series. The change in trend could also be part of a longer cycle, though it is impossible to tell from this graph as it only goes back to 2006.\n\n#### Lag Plots\n\n```{r lag_plots, echo = FALSE}\narrests_ts <- ts(scale(arrests_by_date$total), start = c(2006, 1), frequency = 12)\n\nts_lags(arrests_ts, lags = 1:12)\n```\n\nLooking at the lag plot up to a lag of 12 months, we can see that the data are clearly not random, as a linear shape exists in each lag that we observe here. Seasonality is harder to observe here, as each month does not appear to be clustered alongside other observations of the same month. This could be due to the large number of points, however.\n\n```{r lag_48, echo = FALSE}\nts_lags(arrests_ts, lags = c(12, 24, 36, 48))\n```\n\nIf we look up to a lag of 48 months, we can see that as the lag increases, the data get more random. The Lag 48 plot exhibiting less of a linear pattern than the lag 12 plot, which is fairly linear.\n\n#### Decomposition\n\n```{r decomposing, echo = FALSE}\nplot(decompose(arrests_ts, \"multiplicative\"))\n```\n\nWe can see the trend here that we were able to observe on the initial graph. There is horizontal movement during the first half of the observed period and then a clear downward trend until 2020. After that, it reverses and increases until the present day.\n\nRemoving the trend allows us to see some seasonality. Once the seasonality has been averaged out as it has been here, the clear dips in arrests towards the end of each year remain and there is a clear pattern between the large dips at the end of each year.\n\nThere seems to be more noise in the more recent data, which could be something interesting to look into.\n\n#### ACF and PACF\n\n```{r acf, echo = FALSE}\nggAcf(arrests_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Arrests\")\n```\n\nThe ACF values are decaying towards zero as lag increases, which is evidence that this series needs to be differenced.\n\n```{r pacf, echo = FALSE}\nggPacf(arrests_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Arrests\")\n```\n\nSpikes can be seen at lags of 1, 2, 12, and 13.\n\n#### Augmented Dickey-Fuller Test\n\n```{r adf, echo = FALSE}\nadf.test(arrests_ts)\n```\n\nThe ADF tests returns a p-value of 0.26, meaning we do not have enough evidence to reject the null hypotheses, the series is not stationary.\n\n#### Detrend and Difference\n\n```{r detrend_and_difference}\ndetrend <- resid(lm(arrests_by_date$total ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(arrests_ts)\n```\n\n```{r multifigure_1}\ngrid.arrange(autoplot(arrests_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nThe detrended series (the middle plot) does not seem to be vastly different from the original series. This could be evidence that there is not much of a trend in the data. The differenced series looks to be stationary, which suggests that there may be a trend.\n\n```{r multifigure_2}\nggtsdisplay(difference)\n```\n\nThis ACF has positive spikes at 12, 24, and 36, meaning once the trend is removed, the seasonality becomes evident. The ACF of the differenced time series provides strong evidence in support of seasonality. A SARIMA model would best suit this time series. \n\n### Assault\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n        x = ~month, \n        y = ~assault, \n        name = \"Assault\",\n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Assault\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis time series follows a very similar pattern to the overall arrests series. There is an upward trend until around 2013 then a downward trend to the minimum value in April 2020, then a sharp increase until today. The data are clearly seasonal as well, seeming to follow a yearly pattern with the yearly minimum happening each winter.\n\n#### Lag Plots\n\n```{r, echo = FALSE}\nassault_ts <- ts(scale(arrests_by_crime$assault), start = c(2006, 1), frequency = 12)\n\nts_lags(assault_ts, lags = 1:12)\n```\n\nThere is the most correlation between lags at a lag value of 12, further increasing evidence for the seasonality of this series. There appears to be less correlation here than in the total time series, though.\n\n```{r, echo = FALSE}\nts_lags(assault_ts, lags = c(12, 24, 36, 48))\n```\n\nThere is some correlation between yearly lags, meaning this may be a good candidate for seasonal differencing. This correlation appears to decrease as the lag increases.\n\n#### Decomposition\n\n```{r, echo = FALSE}\nplot(decompose(assault_ts, \"additive\"))\n```\n\nDecomposition reveals the trend we noticed in the overall plot, with the drop in 2020. The increase and decrease before that point, however, may be less than we initially thought.\n\n#### ACF and PACF\n\n```{r, echo = FALSE}\nggAcf(assault_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Assault Arrests\")\n```\n\nThe ACF Plot is decaying towards 0 though there is evidence of seasonality in the correlation between lags.\n\n```{r}\nggPacf(assault_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Assault Arrests\")\n\n```\n\nSpikes can be seen at lags 1, 2, 3, and 4.\n\n#### Augmented Dickey-Fuller Test\n\n```{r echo = FALSE}\nadf.test(assault_ts)\n```\n\nThe ADF tests returns a p-value of less than 0.01, meaning we do not have enough evidence to reject the null hypotheses, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$assault ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(assault_ts)\n\ngrid.arrange(autoplot(assault_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nDetrending does not change the time series much, suggesting the trend we saw earlier was not as significant as we thought. The time series was stationary before according to the ADF test, meaning differencing did not do much.\n\n```{r}\nggtsdisplay(difference)\n```\n\n\nThe evidence of seasonality throughout this process indicates a SARIMA model might be the best for this time series. \n\n### Controlled Substance Possession\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_possession, \n            name = \"Controlled Substance Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Controlled Substance Possession\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis looks different from the overall arrests time series. There is a clear negative linear trend in this series, though that trend hit its minimum in July 2020 and has generally been increasing since, though only slightly compared to the initial decrease.\n\n#### Lag Plots\n\n```{r}\ncontrolled_pos_ts <- ts(scale(arrests_by_crime$controlled_substance_possession), start = c(2006, 1), frequency = 12)\n\nts_lags(controlled_pos_ts, lags = 1:12)\n```\n\nThis series appears to be highly correlated as all of these lags show high levels of correlation.\n\n```{r}\nts_lags(controlled_pos_ts, lags = c(12, 24, 36, 48))\n```\n\nLike the other series, the correlation between lags gets less as the lag increases, though it is still fairly high.\n\n#### Decomposition\n\n```{r}\nplot(decompose(controlled_pos_ts, \"additive\"))\n```\n\nThe time series is clearly additive, and the negative trend becomes clear when decomposed. There does appear to be a seasonal component.\n\n#### ACF and PACF\n\n```{r}\nggAcf(controlled_pos_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Controled Substance Possession Arrests\")\n```\n\nThis is evidence against seasonality, and evidence that the series should be differenced.\n\n```{r}\nggPacf(controlled_pos_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Controled Substance Possession Arrests\")\n\n```\n\nSpikes are seen at 1, 2, 3, 8, and 12.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(controlled_pos_ts)\n```\n\nThe ADF test shows that this series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$controlled_substance_possession ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(controlled_pos_ts)\n\ngrid.arrange(autoplot(controlled_pos_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n```\n\nDetrending clearly changes the time series to be more stationary, meaning there is a clear trend. Differencing also moves us closer to a stationary time series.\n\n```{r}\nggtsdisplay(difference)\n\n```\nThis series also seems to have a significant seasonal component, we will fit a SARIMA model. \n\n### Marijuana Possession\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_possession, \n            name = \"Marijuana Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Marijuana Possession\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis is an interesting one, as there is a clear positive trend at the start of the series which quickly reverses when policy changes were made as discussed before. The series eventually goes to zero as marijuana possession is now legal in New York City.\n\n#### Lag Plots\n\n```{r}\nmarijuana_pos_ts <- ts(scale(arrests_by_crime$marijuana_possession), start = c(2006, 1), frequency = 12)\n\nts_lags(marijuana_pos_ts, lags = 1:12)\n```\n\nThe lag plots look different from most others as there is less correlation in lag 12 than in lag 1, suggesting the data may not be seasonal.\n\n```{r}\nts_lags(marijuana_pos_ts, lags = c(12, 24, 36, 48))\n```\n\nThere is very little lag correlation over the 4 year period, even more evidence against seasonality.\n\n#### Decomposition\n\n```{r}\nplot(decompose(marijuana_pos_ts, \"additive\"))\n```\n\nWe can clearly see the trend observed in the initial plot here in the decomposition. If there were to be a seasonal component it looks to be yearly, but it is hard to tell.\n\n#### ACF and PACF\n\n```{r}\nggAcf(marijuana_pos_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Marijuana Possession Arrests\")\n```\n\nWe should difference this series, this ACF plot looks just like the others.\n\n```{r}\nggPacf(marijuana_pos_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Marijuana Possession Arrests\")\n\n```\n\nThere is a large spike at a lag of 1, then some smaller spikes at 2 and 5.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(marijuana_pos_ts)\n```\n\nWe do not have enough evidence to reject the null hypothesis, the series may not be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$marijuana_possession ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(marijuana_pos_ts)\n\ngrid.arrange(autoplot(marijuana_pos_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n\n```\n\nThe differenced plot looks more stationary, suggesting that differencing may be useful here. The strong seasonal component suggests a SARIMA model would be useful. \n\n### Motor Vehicle Theft\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~motor_vehicle_theft, \n            name = \"Motor Vehicle Theft\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Motor Vehicle Theft\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis series looks the most stationary out of any so far, there really does not seem to be any patterns to it.\n\n#### Lag Plots\n\n```{r}\nmotor_theft_ts <- ts(scale(arrests_by_crime$motor_vehicle_theft), start = c(2006, 1), frequency = 12)\n\nts_lags(motor_theft_ts, lags = 1:12)\n```\n\nThe lag plots support that conclusion, there seems to be little to no correlation between lags at any level.\n\n```{r}\nts_lags(motor_theft_ts, lags = c(12, 24, 36, 48))\n```\n\nThe absence of correlation continues up through high level of lag.\n\n#### Decomposition\n\n```{r}\nplot(decompose(motor_theft_ts, \"additive\"))\n```\n\nThe random component looks fairly similar to the observed series, which would make sense for a stationary series.\n\n#### ACF and PACF\n\n```{r}\nggAcf(motor_theft_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Motor Vehicle Theft Arrests\")\n```\n\nThere may be a slight seasonal component, but it is hard to tell.\n\n```{r}\nggPacf(motor_theft_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Motor Vehicle Theft Arrests\")\n\n```\n\nThere are spikes at 1, 2, 3, and 4, and there may be some seasonality.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(motor_theft_ts)\n```\n\nWe do not have enough evidence to reject the null hypothesis that the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$motor_vehicle_theft ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(motor_theft_ts)\n\ngrid.arrange(autoplot(motor_theft_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n\n```\n\nThe detrended plot looks very similar to the observed plot. There is no seasonal component here, an ARIMA model will work. \n\n### Murder\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~murder, \n            name = \"Murder\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Murder\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThe series here is mostly stationary until recently when the trend begins to increase. This is both interesting and concerning and should be looked into.\n\n#### Lag Plots\n\n```{r}\nmurder_ts <- ts(scale(arrests_by_crime$murder), start = c(2006, 1), frequency = 12)\n\nts_lags(murder_ts, lags = 1:12)\n```\n\nAs seen in the original graph, there is not much evidence for seasonality.\n\n```{r}\nts_lags(murder_ts, lags = c(12, 24, 36, 48))\n```\n\nEven when looking further out, there is not much evidence for seasonality.\n\n#### Decomposition\n\n```{r}\nplot(decompose(murder_ts, \"additive\"))\n```\n\nWe can see that same trend clearly here, there is an obvious increase in murder rate that started around 2020.\n\n#### ACF and PACF\n\n```{r}\nggAcf(murder_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Murder Arrests\")\n```\n\nThe ACF quickly decreases to 0, which means we may not need to difference it.\n\n```{r}\nggPacf(murder_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Murder Arrests\")\n\n```\n\nThe PACF plot looks good as well, there are only spikes at 1, 2, and 7.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(murder_ts)\n```\n\nThere is not enough evidence to reject the null hypothesis, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$murder ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(murder_ts)\n\ngrid.arrange(autoplot(murder_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n```\n\nThe differenced time series looks stationary, indicating that we may need to difference. There is little evidence for any seasonal components, an ARIMA model would be best. \n\n### Robbery\n\n```{r, echo = FALSE}\nplot_ly(data = arrests_by_crime, \n            x = ~month, \n            y = ~robbery, \n            name = \"Robbery\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Robbery\",\n         xaxis = list(title = \"\"),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThere is a clear negative trend throughout the series until 2020 when it changes significantly and becomes very positive.\n\n#### Lag Plots\n\n```{r}\nrobbery_ts <- ts(scale(arrests_by_crime$robbery), start = c(2006, 1), frequency = 12)\n\nts_lags(robbery_ts, lags = 1:12)\n```\n\nThere is some evidence for seasonality as there does appear to be some correlation between lagged values.\n\n```{r}\nts_lags(robbery_ts, lags = c(12, 24, 36, 48))\n```\n\nSome correlation remains even at larger lag values.\n\n#### Decomposition\n\n```{r}\nplot(decompose(robbery_ts, \"additive\"))\n```\n\nWe can see that the trend does not seem to be as negative as we previously thought, and the dip in 2020 may just be a dip as levels have gone back to post-pandemic values.\n\n#### ACF and PACF\n\n```{r}\nggAcf(robbery_ts, 100) + ggtitle(\"ACF Plot for Annual New York City Robbery Arrests\")\n```\n\nThis series looks like it needs to be differenced as there are many significant ACF values.\n\n```{r}\nggPacf(robbery_ts, 100) + ggtitle(\"PACF Plot for Annual New York City Robbery Arrests\")\n\n```\n\nThere are spikes at 1, 2, and 3.\n\n#### Augmented Dickey-Fuller Test\n\n```{r}\nadf.test(robbery_ts)\n```\n\nWe have enough evidence to reject the null hypothesis, the series may be stationary.\n\n#### Detrend and Difference\n\n```{r}\ndetrend <- resid(lm(arrests_by_crime$robbery ~ arrests_by_date$month, na.action = NULL))\ndifference <- diff(robbery_ts)\n\ngrid.arrange(autoplot(robbery_ts),\n             autoplot(as.ts(detrend)), \n             autoplot(difference), \n             ncol = 1)\n\nggtsdisplay(difference)\n```\n\nThe differenced time series looks to be stationary meaning differencing may be useful. The existence of a clear seasonal component means we should fit a SARIMA model. \n:::\n\n```{r, include = FALSE}\nsave(arrests_ts, \n       assault_ts, \n       controlled_pos_ts, \n       marijuana_pos_ts, \n       motor_theft_ts,\n       murder_ts,\n       robbery_ts, file = \"data/arrests_ts.Rdata\")\n\nwrite.csv(arrests_ts, \"data/arrests_ts.csv\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":false,"output-file":"exploratory_data_analysis.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"litera","fontsize":"1em","title":"Exploratory Data Analysis","editor_options":{"chunk_output_type":"inline"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}