{"title":"Data Visualization","markdown":{"yaml":{"title":"Data Visualization","editor_options":{"chunk_output_type":"inline"},"bibliography":"reference.bib"},"headingText":"import pandas as pd","containsRefs":false,"markdown":"\n\n```{r setup, include = FALSE}\nlibrary(reticulate)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(plotly)\nlibrary(kableExtra)\nuse_condaenv(\"r-env\", required = TRUE)\nload(\"raw_data.Rdata\")\n```\n\n```{python, obtain_data, include = FALSE}\n# from sodapy import Socrata\n# import config\n# \n# arrest_data = \"8h9b-rp9u\"\n# client = Socrata(\"data.cityofnewyork.us\",\n#                  config.app_token,\n#                  username=config.username,\n#                  password=config.password)\n# \n# results = client.get(arrest_data, limit = 6000000)\n# \n# # Convert to pandas DataFrame\n# df = pd.DataFrame.from_records(results)\n# \n# df = df[[\"arrest_date\", \"pd_desc\", \"law_cat_cd\", \"age_group\", \"perp_sex\", \"perp_race\"]]\n```\n\n# New York City Arrests, 2006 - present\n\n```{r visualization, echo = FALSE}\ndf <- df %>%\n  mutate(arrest_date = as.Date(arrest_date, format = \"%m/%d/%Y\"),\n         month = month(arrest_date),\n         year = year(arrest_date))\n\narrests_by_date <- df %>%\n  group_by(month = floor_date(arrest_date, \"month\")) %>%\n  summarize(total = n())\n\narrests_plot <- ggplot(data = arrests_by_date, aes(x = month, y = total)) +\n  geom_line() +\n  ggtitle(\"Arrests in New York City by Date\") +\n  xlab(\"Arrest Date\") +\n  ylab(\"Arrests\")\n\nggplotly(arrests_plot)\n```\n\n## By Crime\n\nIt is important to get an understanding of what types of crimes are commonly committed in New York City, the area we are currently looking at. We want to look at crimes that give us a good idea of the state of public safety in New York City. Those crimes along with their total counts from 2006-2022 are listed below.\n\nHomicide, Burglary, Drug-Related Offenses, Assault, Motor Vehicle Theft, Robbery, Drug-Related Violent Crimes, Domestic Violence\n\nWeapons possession?\n\n```{r arrests_by_crime, echo = FALSE}\narrests_by_crime <- df %>%\n  mutate(pd_desc = ifelse(str_detect(pd_desc, \"ASSAULT\"), \"assault\",\n                          ifelse(str_detect(pd_desc, \"ROBBERY\"), \"robbery\", \n                                 ifelse(str_detect(pd_desc, \"MARIJUANA, POSSESSION\"), \"marijuana_possession\",\n                                        ifelse(str_detect(pd_desc, \"MARIJUANA, SALE\"), \"marijuana_sale\",\n                                               ifelse(str_detect(pd_desc, \"CE,P|NCE, P\"), \"controlled_substance_possession\",\n                                                      ifelse(str_detect(pd_desc, \"E,I|CE, I|E,S|E, S\"), \"controlled_substance_sale\",\n                                                ifelse(str_detect(pd_desc, \"MURDER,UNCLASSIFIED\"), \"murder\", \n                                                       ifelse(str_detect(pd_desc, \"AUTO\"), \"motor_vehicle_theft\",\n                                                          ifelse(str_detect(pd_desc, \"LARCENY\"), \"larceny\", pd_desc)))))))))) %>%\n  group_by(pd_desc) %>%\n  summarize(total = n()) %>% \n  filter(str_detect(pd_desc, \"assault|robbery|marijuana_possession|marijuana_sale|controlled|substance_possession|controlled_substance_sale|murder|motor_vehicle_theft|larceny\"))\n\nkable(arrests_by_crime)\narrests_by_crime\n```\n\nThese categories include multiple types of crimes, each of which is outlined below.\n\n```{r}\narrests_by_crime_detail <- df %>%\n  filter(str_detect(pd_desc, \"ASSAULT|ROBBERY|MARIJUANA, POSSESSION|MARIJUANA, SALE|CE,P|NCE, PE,I|CE, I|E,S|E, S|MURDER,UNCLASSIFIED|AUTO|LARCENY\")) %>% group_by(pd_desc) %>%\n  summarize(total = n())\n\narrests_by_crime_detail\n```\n\n\nLets look at how each of these crimes is changing over time.\n\n```{r arrests_by_crime_pivot, include = FALSE}\narrests_by_crime <- df %>%\n   mutate(pd_desc = ifelse(str_detect(pd_desc, \"ASSAULT\"), \"assault\",\n                          ifelse(str_detect(pd_desc, \"ROBBERY\"), \"robbery\", \n                                 ifelse(str_detect(pd_desc, \"MARIJUANA, POSSESSION\"), \"marijuana_possession\",\n                                        ifelse(str_detect(pd_desc, \"MARIJUANA, SALE\"), \"marijuana_sale\",\n                                               ifelse(str_detect(pd_desc, \"CE,P|NCE, P\"), \"controlled_substance_possession\",\n                                                      ifelse(str_detect(pd_desc, \"E,I|CE, I|E,S|E, S\"), \"controlled_substance_sale\",\n                                                ifelse(str_detect(pd_desc, \"MURDER,UNCLASSIFIED\"), \"murder\", \n                                                       ifelse(str_detect(pd_desc, \"AUTO\"), \"motor_vehicle_theft\",\n                                                          ifelse(str_detect(pd_desc, \"LARCENY\"), \"larceny\", pd_desc)))))))))) %>%\n  filter(str_detect(pd_desc, \"assault|robbery|marijuana_possession|marijuana_sale|controlled|substance_possession|controlled_substance_sale|murder|motor_vehicle_theft|larceny\")) %>%\n  group_by(month = floor_date(arrest_date, \"month\"), pd_desc) %>%\n  summarize(count = n()) %>%\n  pivot_wider(names_from = pd_desc, values_from = count, values_fill = 0) %>%\n  ungroup()\n```\n\n```{r plot_by_crime, echo = FALSE, warning=FALSE}\nplot_ly(data = arrests_by_crime, \n        x = ~month, \n        y = ~murder, \n        name = \"Murder\",\n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~assault, \n            name = \"Assault\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~robbery, \n            name = \"Robbery\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~larceny, \n            name = \"Larceny\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~motor_vehicle_theft, \n            name = \"Motor Vehicle Theft\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_possession, \n            name = \"Marijuana Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_sale, \n            name = \"Marijuana Sale\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_possession, \n            name = \"Controlled Substance Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_sale, \n            name = \"Controlled Substance Sale/Intent\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Crime by Type\",\n         xaxis = list(title = \"\",\n                      tickvals = c(\"2006\", \"2010\", \"2014\", \"2018\", \"2022\"),\n                      ticktext = c(\"2006\", \"2010\", \"2014\", \"2018\", \"2022\")),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis graph includes the eight most common types of arrests made over the time period. Some interesting patterns reveal themselves when the data are categorized as such, particularly the arrests for marijuana possession. They spike around 2011 but then drop off quickly and today are non-existent. This is an excellent example to use to observe the effect that real-world events have on the trends we observe here. In 2014, New York City mayor Bill de Blasio told the NYPD to stop arrests for marijuana possession and instead issue tickets in attempts to decriminalize marijuana [@Dizard_2014]. A drop in arrests is clearly seen around that time period. Around the same time, New York Governor Andrew Cuomo signed legislation which would allow the use of cannabis for medicinal purposes [@Campbell_2014]. Then, in 2021, recreational cannabis was legalized for adults over 21, up to a specific amount. Since then, the NYPD has not listed any crime related to marijuana, as evidenced by there being no arrests for possession on the graph past 2021.\n\n```{r save_data, include = FALSE}\nsave(list = c(\"arrests_by_crime\", \"arrests_by_date\"), file = \"arrest_data.Rdata\")\n```\n","srcMarkdownNoYaml":"\n\n```{r setup, include = FALSE}\nlibrary(reticulate)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(plotly)\nlibrary(kableExtra)\nuse_condaenv(\"r-env\", required = TRUE)\nload(\"raw_data.Rdata\")\n```\n\n```{python, obtain_data, include = FALSE}\n# import pandas as pd\n# from sodapy import Socrata\n# import config\n# \n# arrest_data = \"8h9b-rp9u\"\n# client = Socrata(\"data.cityofnewyork.us\",\n#                  config.app_token,\n#                  username=config.username,\n#                  password=config.password)\n# \n# results = client.get(arrest_data, limit = 6000000)\n# \n# # Convert to pandas DataFrame\n# df = pd.DataFrame.from_records(results)\n# \n# df = df[[\"arrest_date\", \"pd_desc\", \"law_cat_cd\", \"age_group\", \"perp_sex\", \"perp_race\"]]\n```\n\n# New York City Arrests, 2006 - present\n\n```{r visualization, echo = FALSE}\ndf <- df %>%\n  mutate(arrest_date = as.Date(arrest_date, format = \"%m/%d/%Y\"),\n         month = month(arrest_date),\n         year = year(arrest_date))\n\narrests_by_date <- df %>%\n  group_by(month = floor_date(arrest_date, \"month\")) %>%\n  summarize(total = n())\n\narrests_plot <- ggplot(data = arrests_by_date, aes(x = month, y = total)) +\n  geom_line() +\n  ggtitle(\"Arrests in New York City by Date\") +\n  xlab(\"Arrest Date\") +\n  ylab(\"Arrests\")\n\nggplotly(arrests_plot)\n```\n\n## By Crime\n\nIt is important to get an understanding of what types of crimes are commonly committed in New York City, the area we are currently looking at. We want to look at crimes that give us a good idea of the state of public safety in New York City. Those crimes along with their total counts from 2006-2022 are listed below.\n\nHomicide, Burglary, Drug-Related Offenses, Assault, Motor Vehicle Theft, Robbery, Drug-Related Violent Crimes, Domestic Violence\n\nWeapons possession?\n\n```{r arrests_by_crime, echo = FALSE}\narrests_by_crime <- df %>%\n  mutate(pd_desc = ifelse(str_detect(pd_desc, \"ASSAULT\"), \"assault\",\n                          ifelse(str_detect(pd_desc, \"ROBBERY\"), \"robbery\", \n                                 ifelse(str_detect(pd_desc, \"MARIJUANA, POSSESSION\"), \"marijuana_possession\",\n                                        ifelse(str_detect(pd_desc, \"MARIJUANA, SALE\"), \"marijuana_sale\",\n                                               ifelse(str_detect(pd_desc, \"CE,P|NCE, P\"), \"controlled_substance_possession\",\n                                                      ifelse(str_detect(pd_desc, \"E,I|CE, I|E,S|E, S\"), \"controlled_substance_sale\",\n                                                ifelse(str_detect(pd_desc, \"MURDER,UNCLASSIFIED\"), \"murder\", \n                                                       ifelse(str_detect(pd_desc, \"AUTO\"), \"motor_vehicle_theft\",\n                                                          ifelse(str_detect(pd_desc, \"LARCENY\"), \"larceny\", pd_desc)))))))))) %>%\n  group_by(pd_desc) %>%\n  summarize(total = n()) %>% \n  filter(str_detect(pd_desc, \"assault|robbery|marijuana_possession|marijuana_sale|controlled|substance_possession|controlled_substance_sale|murder|motor_vehicle_theft|larceny\"))\n\nkable(arrests_by_crime)\narrests_by_crime\n```\n\nThese categories include multiple types of crimes, each of which is outlined below.\n\n```{r}\narrests_by_crime_detail <- df %>%\n  filter(str_detect(pd_desc, \"ASSAULT|ROBBERY|MARIJUANA, POSSESSION|MARIJUANA, SALE|CE,P|NCE, PE,I|CE, I|E,S|E, S|MURDER,UNCLASSIFIED|AUTO|LARCENY\")) %>% group_by(pd_desc) %>%\n  summarize(total = n())\n\narrests_by_crime_detail\n```\n\n\nLets look at how each of these crimes is changing over time.\n\n```{r arrests_by_crime_pivot, include = FALSE}\narrests_by_crime <- df %>%\n   mutate(pd_desc = ifelse(str_detect(pd_desc, \"ASSAULT\"), \"assault\",\n                          ifelse(str_detect(pd_desc, \"ROBBERY\"), \"robbery\", \n                                 ifelse(str_detect(pd_desc, \"MARIJUANA, POSSESSION\"), \"marijuana_possession\",\n                                        ifelse(str_detect(pd_desc, \"MARIJUANA, SALE\"), \"marijuana_sale\",\n                                               ifelse(str_detect(pd_desc, \"CE,P|NCE, P\"), \"controlled_substance_possession\",\n                                                      ifelse(str_detect(pd_desc, \"E,I|CE, I|E,S|E, S\"), \"controlled_substance_sale\",\n                                                ifelse(str_detect(pd_desc, \"MURDER,UNCLASSIFIED\"), \"murder\", \n                                                       ifelse(str_detect(pd_desc, \"AUTO\"), \"motor_vehicle_theft\",\n                                                          ifelse(str_detect(pd_desc, \"LARCENY\"), \"larceny\", pd_desc)))))))))) %>%\n  filter(str_detect(pd_desc, \"assault|robbery|marijuana_possession|marijuana_sale|controlled|substance_possession|controlled_substance_sale|murder|motor_vehicle_theft|larceny\")) %>%\n  group_by(month = floor_date(arrest_date, \"month\"), pd_desc) %>%\n  summarize(count = n()) %>%\n  pivot_wider(names_from = pd_desc, values_from = count, values_fill = 0) %>%\n  ungroup()\n```\n\n```{r plot_by_crime, echo = FALSE, warning=FALSE}\nplot_ly(data = arrests_by_crime, \n        x = ~month, \n        y = ~murder, \n        name = \"Murder\",\n        type = \"scatter\", \n        mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~assault, \n            name = \"Assault\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~robbery, \n            name = \"Robbery\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~larceny, \n            name = \"Larceny\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~motor_vehicle_theft, \n            name = \"Motor Vehicle Theft\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_possession, \n            name = \"Marijuana Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~marijuana_sale, \n            name = \"Marijuana Sale\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_possession, \n            name = \"Controlled Substance Possession\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  add_trace(data = arrests_by_crime, \n            x = ~month, \n            y = ~controlled_substance_sale, \n            name = \"Controlled Substance Sale/Intent\",\n            type = \"scatter\",\n            mode = \"lines\",\n        showlegend = TRUE) %>%\n  layout(title = \"Crime by Type\",\n         xaxis = list(title = \"\",\n                      tickvals = c(\"2006\", \"2010\", \"2014\", \"2018\", \"2022\"),\n                      ticktext = c(\"2006\", \"2010\", \"2014\", \"2018\", \"2022\")),\n         yaxis = list(title = \"Arrests\"))\n```\n\nThis graph includes the eight most common types of arrests made over the time period. Some interesting patterns reveal themselves when the data are categorized as such, particularly the arrests for marijuana possession. They spike around 2011 but then drop off quickly and today are non-existent. This is an excellent example to use to observe the effect that real-world events have on the trends we observe here. In 2014, New York City mayor Bill de Blasio told the NYPD to stop arrests for marijuana possession and instead issue tickets in attempts to decriminalize marijuana [@Dizard_2014]. A drop in arrests is clearly seen around that time period. Around the same time, New York Governor Andrew Cuomo signed legislation which would allow the use of cannabis for medicinal purposes [@Campbell_2014]. Then, in 2021, recreational cannabis was legalized for adults over 21, up to a specific amount. Since then, the NYPD has not listed any crime related to marijuana, as evidenced by there being no arrests for possession on the graph past 2021.\n\n```{r save_data, include = FALSE}\nsave(list = c(\"arrests_by_crime\", \"arrests_by_date\"), file = \"arrest_data.Rdata\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"data_visualization.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"litera","fontsize":"1em","title":"Data Visualization","editor_options":{"chunk_output_type":"inline"},"bibliography":["reference.bib"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}